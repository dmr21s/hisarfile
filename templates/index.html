<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hisar Uniq - Dosya Yöneticisi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="color-scheme" content="light dark" />
    <link rel="icon" type="image/png" href="/static/logo.png" />
    <meta name="theme-color" content="#0f172a" />
  </head>
  <body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-gray-800">
    <!-- Drag & Drop Overlay -->
    <div id="drop-overlay" class="fixed inset-0 bg-blue-600/20 backdrop-blur-sm hidden items-center justify-center z-40">
      <div class="rounded-2xl border-4 border-dashed border-white/80 bg-white/70 p-8 text-center shadow-2xl">
        <div class="text-3xl font-semibold text-blue-700">Dosyaları veya klasörleri bırak</div>
        <div class="mt-2 text-sm text-blue-900">Alt klasör yapısı korunur</div>
      </div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-30 border-b bg-white/70 backdrop-blur supports-[backdrop-filter]:bg-white/60">
      <div class="mx-auto max-w-7xl px-4 py-3 flex items-center gap-4 flex-wrap">
        <div class="flex items-center gap-3 min-w-0">
          <img src="/static/logo.png" alt="Hisar Uniq" class="h-9 w-auto select-none" />
          <div class="text-lg font-semibold tracking-wide text-slate-800 hidden sm:block">Dosya Yöneticisi</div>
        </div>

        <div id="breadcrumb" class="flex-1 text-sm overflow-hidden text-ellipsis whitespace-nowrap"></div>

        <!-- session -->
        <div class="flex items-center gap-3">
          <div id="user-chip" class="hidden rounded-full bg-slate-100 px-3 py-1 text-sm text-slate-700"></div>
          <a id="btn-admin" href="/admin" class="hidden rounded-md border px-3 py-1.5 text-sm hover:bg-slate-50">Yönetim</a>
          <button id="btn-logout" class="hidden rounded-md border px-3 py-1.5 text-sm hover:bg-slate-50">Çıkış</button>
        </div>

        <div class="flex gap-2">
          <button id="btn-new-folder" class="inline-flex items-center gap-2 rounded-lg bg-blue-500 px-4 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-blue-600 active:bg-blue-700 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Yeni Klasör
          </button>
          <button id="btn-upload-files" class="inline-flex items-center gap-2 rounded-lg bg-green-500 px-4 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-green-600 active:bg-green-700 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            Dosya
          </button>
          <button id="btn-upload-folder" class="inline-flex items-center gap-2 rounded-lg bg-teal-500 px-4 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-teal-600 active:bg-teal-700 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 13h6m-3-3v6"/>
            </svg>
            Klasör
          </button>
        </div>
        <input id="file-picker" type="file" multiple class="hidden" />
        <input id="folder-picker" type="file" webkitdirectory directory class="hidden" />
      </div>
    </header>

    <!-- Main -->
    <main class="mx-auto max-w-7xl px-4 py-6">
      <!-- Current folder info -->
      <div class="flex items-center justify-between mb-4">
        <div class="text-lg">
          <span class="text-gray-500">Klasör:</span>
          <span id="current-folder" class="font-semibold"></span>
        </div>
        <div id="status" class="text-sm text-gray-500"></div>
      </div>

      <!-- Folders grid -->
      <section>
        <h2 class="text-base font-semibold text-gray-700 mb-2">Klasörler</h2>
        <!-- Moved: search + view toggles toolbar -->
        <div class="mb-3 flex items-center justify-between gap-3 flex-wrap">
          <div class="relative max-w-md w-full">
            <input id="search-input" type="text" placeholder="Ara (bu klasör ve altı)" class="w-full rounded-md border px-3 py-2 pr-9 text-sm focus:outline-none focus:ring focus:ring-indigo-200" />
            <span class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-gray-400">⌕</span>
          </div>
          <div class="flex items-center gap-2">
            <select id="folder-sort" class="rounded-md border bg-white px-2 py-1.5 text-sm">
              <option value="name_asc">Klasör: A → Z</option>
              <option value="name_desc">Klasör: Z → A</option>
            </select>
            <div class="inline-flex items-center rounded-md border bg-white">
            <button id="view-grid" class="px-3 py-1.5 text-sm hover:bg-gray-50" title="Klasörler: Izgara">Izgara</button>
            <button id="view-list" class="px-3 py-1.5 text-sm hover:bg-gray-50" title="Klasörler: Liste">Liste</button>
            </div>
          </div>
        </div>
        <div id="folders-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
        <div id="folders-empty" class="hidden text-gray-500 text-sm">Klasör yok.</div>
      </section>

      <!-- Files table -->
      <section id="files-section" class="mt-8 hidden">
        <h2 class="text-base font-semibold text-gray-700 mb-2">Dosyalar</h2>
        <div class="mb-2 flex items-center justify-end gap-2">
          <select id="file-sort" class="rounded-md border bg-white px-2 py-1.5 text-sm">
            <option value="name_asc">Ad: A → Z</option>
            <option value="name_desc">Ad: Z → A</option>
            <option value="size_asc">Boyut: Küçükten → Büyüğe</option>
            <option value="size_desc">Boyut: Büyükten → Küçüğe</option>
            <option value="date_asc">Tarih: Eski → Yeni</option>
            <option value="date_desc">Tarih: Yeni → Eski</option>
          </select>
        </div>
        <div class="overflow-hidden rounded-lg border bg-white">
          <table class="min-w-full divide-y table-auto">
            <thead id="files-thead" class="bg-gray-50">
              <tr>
                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Ad</th>
                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Boyut</th>
                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Güncelleme</th>
                <th class="px-4 py-2 text-right text-xs font-semibold text-gray-600">İşlemler</th>
              </tr>
            </thead>
            <tbody id="files-tbody" class="divide-y bg-white"></tbody>
          </table>
          <div id="files-empty" class="hidden p-4 text-sm text-gray-500">Bu klasörde dosya yok.</div>
        </div>
      </section>
    </main>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 hidden">
      <div id="toast-inner" class="rounded-md px-4 py-2 shadow-lg"></div>
    </div>

    <!-- Upload progress -->
    <div id="upload-progress" class="fixed bottom-20 left-1/2 -translate-x-1/2 z-50 hidden w-[min(90vw,28rem)]">
      <div class="rounded-md border bg-white/95 backdrop-blur px-4 py-3 shadow-lg">
        <div id="upload-progress-text" class="text-sm text-slate-700 mb-2">Yükleniyor… %0</div>
        <div class="h-2 w-full rounded bg-slate-200 overflow-hidden">
          <div id="upload-progress-bar" class="h-2 bg-indigo-600 transition-all" style="width:0%"></div>
        </div>
      </div>
    </div>

    <!-- Conflict modal (per-item) -->
    <div id="conflict-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40">
      <div class="w-[min(92vw,28rem)] rounded-xl bg-white shadow-xl">
        <div class="flex items-center justify-between border-b px-4 py-3">
          <div class="font-semibold text-slate-800">İsim Çakışması</div>
          <button id="conflict-close" class="rounded p-1 text-slate-500 hover:bg-slate-100">✕</button>
        </div>
        <div class="px-4 py-3 text-sm text-slate-700">
          <div class="mb-2">Mevcut ad: <span id="conflict-current" class="font-medium"></span></div>
          <label class="block text-xs text-slate-500 mb-1">Yeni ad (yeniden adlandır):</label>
          <input id="conflict-newname" class="w-full rounded-md border px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-indigo-200" />
        </div>
        <div class="px-4 pb-4 grid gap-2">
          <button id="conflict-overwrite" class="rounded-md border px-3 py-2 text-sm text-white bg-rose-600 hover:bg-rose-700">Üzerine Yaz</button>
          <button id="conflict-rename" class="rounded-md border px-3 py-2 text-sm bg-indigo-600 text-white hover:bg-indigo-700">Bu İsimle Kaydet</button>
          <button id="conflict-skip" class="rounded-md border px-3 py-2 text-sm hover:bg-slate-50">Atla</button>
        </div>
      </div>
    </div>

    <!-- Folder operation modal (move/copy/rename) -->
    <div id="folder-op-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40">
      <div class="w-[min(92vw,30rem)] rounded-xl bg-white shadow-xl">
        <div class="flex items-center justify-between border-b px-4 py-3">
          <div class="font-semibold text-slate-800">Klasör İşlemi</div>
          <button id="folder-op-close" class="rounded p-1 text-slate-500 hover:bg-slate-100">✕</button>
        </div>
        <div class="px-4 py-3 grid gap-3 text-sm">
          <div>
            <div class="text-xs text-slate-500 mb-1">Seçilen klasör</div>
            <div id="folder-op-source" class="rounded border bg-slate-50 px-3 py-2 font-medium text-slate-800 truncate"></div>
          </div>
          <div>
            <div class="text-xs text-slate-500 mb-1">İşlem</div>
            <div class="flex items-center gap-4">
              <label class="inline-flex items-center gap-1"><input type="radio" name="folder-op-action" value="move" checked class="accent-indigo-600"> Taşı</label>
              <label class="inline-flex items-center gap-1"><input type="radio" name="folder-op-action" value="copy" class="accent-indigo-600"> Kopyala</label>
              <label class="inline-flex items-center gap-1"><input type="radio" name="folder-op-action" value="rename" class="accent-indigo-600"> Yeniden adlandır</label>
            </div>
          </div>
          <div id="folder-op-dest-wrap">
            <label class="block text-xs text-slate-500 mb-1">Hedef klasör</label>
            <!-- Değiştirildi: select -> autocomplete input + datalist (daha kolay seçim) -->
            <div class="relative">
              <input id="folder-op-dest-input" list="folder-op-datalist" autocomplete="off"
                placeholder="Hedef klasörü yazın veya listeden seçin (örn: ortak)" 
                class="w-full rounded-md border bg-white px-3 py-2 text-sm" />
              <datalist id="folder-op-datalist"></datalist>
            </div>
            <div class="text-xs text-slate-400 mt-1">Yazarken öneriler görünecek. Boş bırakılırsa mevcut kök geçerli olur.</div>
          </div>
          <div>
            <label class="block text-xs text-slate-500 mb-1">Yeni ad (opsiyonel)</label>
            <input id="folder-op-newname" class="w-full rounded-md border px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-indigo-200" />
          </div>
        </div>
        <div class="px-4 pb-4 flex items-center justify-end gap-2">
          <button id="folder-op-cancel" class="rounded-md border px-3 py-2 text-sm hover:bg-slate-50">İptal</button>
          <button id="folder-op-confirm" class="rounded-md bg-indigo-600 px-3 py-2 text-sm text-white hover:bg-indigo-700">Uygula</button>
        </div>
      </div>
    </div>

    <script src="/static/js/main.js"></script>
  </body>
</html>
